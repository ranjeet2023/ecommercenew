	<script type="text/javascript">
		localStorage.setItem("ak_search", "");
		localStorage.setItem("lg_search", "");

		$(document).ready(function() {
            var xhr;
			var total_selected = 0;
			var page_record_from = 0;
			var selected_ids = "";

			function request_call(url, mydata) {
				if (xhr && xhr.readyState != 4) {
					xhr.abort();
				}

				xhr = $.ajax({
					url: url,
					type: 'post',
					dataType: 'json',
					headers: {'X-CSRF-TOKEN': $('meta[name="csrf-token"]').attr('content')},
					data: mydata,
				});
			}

            $("#render_string").delegate('.edit_port', 'click', function() {

				var ids = $(this).attr('data-id');

				$('#hide_edit_port_' + ids).hide();
				$('#portspan_' + ids).hide();
				$('#p_city_change_' + ids).append('<option value="">Please select city</option><option value="India">India</option><option value="Hongkong">Hongkong</option><option value="USA">USA</option><option value="Australia">Australia</option>');
				$('#p_city_change_' + ids).val(location);
				$('#p_city_change_' + ids).show();
				$('#hide_save_port_' + ids).show();
                $('select option[value=""]').attr("selected",true);
            });
            $("#render_string").delegate('.save_port', 'click', function() {
            var ids = $(this).attr('data-id');
            var port = $('#p_city_change_' + ids).val();
                    if (port != "" && port != null) {
                        blockUI.block();
                        request_call("{{ url('port-enquiry-status') }}", "id=" + ids +"&port=" + port);
                        xhr.done(function(mydataorder) {
                            blockUI.release();
                $('#hide_save_port_' + ids).hide();
                $('#hide_edit_port_' + ids).show();
                    $('#p_city_change_' + ids).hide();
                            $('#portspan_' + ids).html(port);
                            $('#portspan_' + ids).show();
                Swal.fire("Success!", mydataorder.success,'success').then((result) => {
                            window.location.reload();
                        });
                    });
				} else {
					alert("Location can't be empty..!");
				}
            });

            var totalstone = 0;
			var TotalCarat = 0;
			var TotalPerCarat = 0;
			var TotalPrice = 0;
			var TotalAPerCarat = 0;
			var TotalAPrice = 0;

            $('.table').delegate('.check_all', 'change', function() {
                if ($(this).prop('checked') == true) {
                    $('.check_box').each(function() {
                        this.checked = true;
                    });
                } else {
                    $('.check_box').each(function() {
                        this.checked = false;
                    });
                }
                if ($('#render_string .check_box:checked').length == $('#render_string .check_box').length) {
                    $('.check_all').each(function() {
                        this.checked = true;
                    });
                }

                var stone = 0;
				var Carat = 0;
				var PerCarat = 0;
				var Price = 0;
				var APerCarat = 0;
				var APrice = 0;
                $('#render_string .check_box:checked').each(function() {
					stone += 1;
					Carat += parseFloat($(this).data('carat'));
					Price += parseFloat($(this).data('price'));
					APrice += parseFloat($(this).data('aprice'));
					PerCarat = Price / Carat;
					APerCarat = APrice / Carat;
				});

				$('#total_pcs').text(stone);
				$('#totalcarat').html(Carat.toFixed(2));
				$('#totalpercarat').html(PerCarat.toFixed(2));
				$('#totalamount').html(Price.toFixed(2));
				@if (Auth::user()->user_type == 1||4||5||6)
					$('#totalApercarat').html(APerCarat.toFixed(2));
					$('#totalAamount').html(APrice.toFixed(2));
				@endif
			});

			$('#render_string').delegate('.check_box', 'change', function() {
				var stone = 0;
				var Carat = 0;
				var PerCarat = 0;
				var Price = 0;
				var APerCarat = 0;
				var APrice = 0;
				$('#render_string .check_box:checked').each(function() {
					stone += 1;
					Carat += parseFloat($(this).data('carat'));
					Price += parseFloat($(this).data('price'));
					APrice += parseFloat($(this).data('aprice'));
					PerCarat = Price / Carat;
					APerCarat = APrice / Carat;
				});

				$('#total_pcs').text(stone);
				$('#totalcarat').html(Carat.toFixed(2));
				$('#totalpercarat').html(PerCarat.toFixed(2));
				$('#totalamount').html(Price.toFixed(2));
				@if (Auth::user()->user_type == 1||4||5||6)
					$('#totalApercarat').html(APerCarat.toFixed(2));
					$('#totalAamount').html(APrice.toFixed(2));
				@endif

				totalstone = stone;
				TotalCarat = Carat.toFixed(2);
				TotalPerCarat = PerCarat.toFixed(2);
				TotalPrice = Price.toFixed(2);
				TotalAPerCarat = APerCarat.toFixed(2);
				TotalAPrice = APrice.toFixed(2);
			});

			$('.menu-item').delegate('.prioritychange', 'click', function() {
                let priority = $(this).attr('data-priority');
                let order_id = $(this).attr('data-order_id');
                Swal.fire({
                    title: 'Change Priority?',
                    text: "Are you sure to Change Priority To - "+ priority,
                    icon: 'question',
                    showCancelButton: true,
                    confirmButtonColor: '#3085d6',
                    cancelButtonColor: '#d33',
                    confirmButtonText: 'Yes, Change it!',
                }).then((result) => {
                    if (result.isConfirmed) {
                        blockUI.block();
                        request_call("{{ url('admin-update-priority-status') }}", "priority=" + priority + "&order_id=" + order_id);
                        xhr.done(function(mydata) {
                            blockUI.release();
                            Swal.fire({
                                text: mydata.success,
                                type: "success",
                                title: "Priority Changed Successfully!",
                                icon: 'success',
                            }).then((result) => {
                                location.reload();
                            });
                        })
                    }
                });
            })

            $('#render_string').delegate('.order_approve_supplier', 'click', function(event) {
                let order_id = $(this).attr('data-order');
                let certi_no = $(this).attr('data-certino');
                // let customer_id = $(this).attr('data-userid');
                let status = $(this).attr('data-status');
                Swal.fire({
                    heightAuto: false,
                    width: '50%' ,
                    html:`<div class="container">
                        <div class="row">
                            <div class="col-md-6">
                                <label class="float-start">Stone Location</label>
                                <select class="form-select" id="stonelocation" >
                                    <option value="">Stone Location</option>
                                    <option value="surat">SURAT</option>
                                    <option value="mumbai">MUMBAI</option>
                                    <option value="hongkong">HONG KONG</option>
                                    <option value="usa">USA</option>
                                </select>
                            </div>
                            <div class="col-md-6">
                                <label class="float-start">Certificate Location</label>
                                <select class="form-select" id="certificatelocation">
                                    <option value="">Certificate Location</option>
                                    <option value="surat">SURAT</option>
                                    <option value="mumbai">MUMBAI</option>
                                    <option value="hongkong">HONG KONG</option>
                                    <option value="usa">USA</option>
                                </select>
                            </div>
                        </div>
                        <div class="row m-2">
                            <div class="col-md-6">
                                <label class="float-start">No BGM :</label>
                                <label for="yes">YES</label>
                                <input type="radio" name="bgm" id="yes-bgm" value="YES">
                                <label for="no">NO </label>
                                <input type="radio" name="bgm" id="no-bgm" value="NO" checked>
                                </div>
                                <div class="col-md-6">
                                <label class="float-start">Eye Clean :</label>
                                <label for="YES">YES</label>
                                <input type="radio" name="eyeclean" id="yes-eye-clean" value="YES" checked>
                                <label for="NO">NO</label>
                                <input type="radio" name="eyeclean" id="no-eye-clean" value="NO" >
                            </div>
                        </div>
                        <div class="row">
                            <div class="col-md-4">
                                <label class="float-start" >Brown</label>
                                <select class="form-select" id="brown">
                                    <option value="">Please Select</option>
                                    <option value="none" >None</option>
                                    <option value="light">Light</option>
                                    <option value="medimu">Medium</option>
                                    <option value="heavy">Heavy</option>
                                </select>
                            </div>
                            <div class="col-md-4">
                                <label class="float-start" id>Green</label>
                                <select class="form-select" id="green">
                                <option value="">Please Select</option>
                                    <option value="none">None</option>
                                    <option value="light">Light</option>
                                    <option value="medimum">Medium</option>
                                    <option value="heavy">Heavy</option>
                                </select>
                            </div>
                            <div class="col-md-4">
                                <label class="float-start">Milky</label>
                                <select class="form-select" id="milky">
                                <option value="">Please Select</option>
                                    <option value="none" >None</option>
                                    <option value="light">Light</option>
                                    <option value="medium">Medium</option>
                                    <option value="heavy">Heavy</option>
                                </select>
                            </div>
                        <div>
                        <div class="row mt-3">
                                <div class="form-floating">
                                    <textarea class="form-control" placeholder="Leave a comment here" id="comment"></textarea>
                                    <label for="floatingTextarea">Comments</label>
                                </div>
                                </div>
                                </div>`,
                    showCancelButton: true,
                    confirmButtonText: 'Approve',
                    preConfirm: () => {
                        const stonelocation = Swal.getPopup().querySelector('#stonelocation').value
                        const certificatelocation = Swal.getPopup().querySelector('#certificatelocation').value
                        // const bgm = Swal.getPopup().querySelector('#bgm').checked
                        // const eyeclean = Swal.getPopup().querySelector('#eyeclean').checked
                        const milky = Swal.getPopup().querySelector('#milky').value
                        const brown = Swal.getPopup().querySelector('#brown').value
                        const green = Swal.getPopup().querySelector('#green').value
                        const comment = Swal.getPopup().querySelector('#comment').value

                        if(!comment)
                        {
                            Swal.showValidationMessage(`Please Comment what You want`)
                        }
                        if(!green)
                        {
                            Swal.showValidationMessage(`Please Select Green`)
                        }
                        if(!brown)
                        {
                            Swal.showValidationMessage(`Please Select Brown`)
                        }
                        if(!milky)
                        {
                            Swal.showValidationMessage(`Please Select Milky`)
                        }
                        if (!certificatelocation) {
                        Swal.showValidationMessage(`Please Select Certificate Location`)
                    }
                    if (!stonelocation) {
                        Swal.showValidationMessage(`Please Select Stone Location `)
                    }
                }

            }).then((result) => {
                if (result.isConfirmed) {
                    let stonelocation = $('#stonelocation').val();
                    let certificatelocation = $('#certificatelocation').val();
                        let bgm = $("input[name='bgm']:checked").val();
                        let eyeclean = $("input[name='eyeclean']:checked").val();
                        let milky = $('#milky').val();
                        let brown = $('#brown').val();
                        let green = $('#green').val();
                        let comment = $('#comment').val();
                        // request_call("{{ url('supplier-order-status')}}","order_id=" + order_id +"&certi_no=" + certi_no + "&status=" + status +"&comment="+comment);
                        blockUI.block();
                        request_call("{{ url('update-enquiry-list')}}", "order_id=" + order_id +"&certi_no=" + certi_no + "&status=" + status +"&comment="+comment +"&milky="+milky +"&brown="+brown+"&green="+green+"&stonelocation="+stonelocation+"&certificatelocation="+certificatelocation+"&bgm="+bgm+"&eyeclean="+eyeclean);
                        xhr.done(function(mydata) {
                            blockUI.release();
                            Swal.fire({
                                text: 'Approve!',
                                type: "success",
                                icon:'success',
                            }).then((result) => {
                                location.reload();
                            });
                        })
                    }
                });
            });

            $('#render_string').delegate('.order_reject_supplier', 'click', function(event) {
                let order_id = $(this).attr('data-reject');
                let certi_no = $(this).attr('data-certino');
                // let customer_id = $(this).attr('data-userid');
                let status = $(this).attr('data-status');

                Swal.fire({
                    width: 700,
                    icon:'question',
                    html:`<div class="container">
                        <div class="row ">
                            <div class="col-md-12">
                                <label class="float-start">Sold :</label>
                                <label for="yes">YES</label>
                                <input type="radio" name="sold" id="sold-yes" value="YES" >
                                <label for="no">NO </label>
                                <input type="radio" name="sold" id="sold-no" value="NO" checked>
                            </div>
                        </div>
                        <div class="row ">
                            <div class="col-md-12">
                                <label class="float-start">Hold For Other :</label>
                                <label for="YES">YES</label>
                                <input type="radio" name="hold" id="hold-yes" value="YES" >
                                <label for="NO">NO</label>
                                <input type="radio" name="hold" id="hold-no" value="NO" checked>
                            </div>
                        </div>

                        <div class="row mt-3">
                            <div class="form-floating">
                                <textarea class="form-control" placeholder="Leave a comment here" id="comment"></textarea>
                                <label for="floatingTextarea">Comments</label>
                            </div>
                        </div>
                    </div>`,
                    showCancelButton: true,
                    confirmButtonText: 'Submit',
                    preConfirm: () => {
                        let hold = $("input[name='hold']:checked").val();
                        let sold = $("input[name='sold']:checked").val();
                        const comment = Swal.getPopup().querySelector('#comment').value
                        if(!comment)
                        {
                            Swal.showValidationMessage(`Please Comment what You want`)
                        }
                    }

                }).then((result) => {
                    if (result.isConfirmed) {
                        let comment =$('#comment').val();
                        let hold = $("input[name='hold']:checked").val();
                        let sold = $("input[name='sold']:checked").val();
                        blockUI.block();
                        request_call("{{ url('update-enquiry-list')}}","order_id=" + order_id +"&certi_no=" + certi_no + "&status=" + status +"&comment="+comment+"&hold="+hold+"&sold="+sold);
                        xhr.done(function(mydata) {
                            blockUI.release();
                            Swal.fire({
                                text: 'Rejected!',
                                type: "warning",
                                icon: 'error',
                            }).then((result) => {
                                location.reload();
                            });
                        })
                    }
                });
            });

			$('#render_string').delegate('.exchange_rate', 'blur', function (e) {
				if (e.keyCode === 109 || e.keyCode === 189) {
					alert("Not allowed (-)minus sign");
					$(this).val('');
				}

				var id= $(this).attr('data-id');
				var exchange_rate	= $(this).val();
				if (exchange_rate != "")
				{
					request_call("{{ url('admin-update-exchange-rate') }}", "id=" + $.trim(id) + "&exchange_rate=" + exchange_rate);
					xhr.done(function (mydata) {

					});
				}
			});

			$('#render_string').delegate('.order_a_r', 'click', function() {

				var id = $(this).attr('id');
				var certino = $(this).attr('data-certino');
				var customer_id = $(this).attr('data-userid');
				var order_status = $(this).attr('data-status');

				if(order_status == 'REJECT'){
					$("#header-modal").html('<div class="modal-dialog modal-lg">'
									+'<div class="modal-content">'
										+'<div class="modal-header">'
											+'<h4 class="modal-title">Are you sure you want to Reject request?  Order ID : '+id+'</h4>'
											+'<div class="btn btn-icon btn-sm btn-active-light-primary ms-2" data-bs-dismiss="modal" aria-label="Close"><i class="fa fa-times"></i></div>'
										+'</div>'
										+'<div class="modal-body">'
											+'<div class="row">'
												+'<div class="col-md-12 col-sm-12 col-xs-12">'
													+'<div class="row " style="width: 100%;">'
														+'<textarea class="form-control comment" rows="3" placeholder="Comments" required name="comment" maxlength="100" id="comment"></textarea>'
														+'<span class="com"></span></br><Span><span class="GFG">100</span> Characters Remaining </span>'
													+'</div>'
												+'</div>'
											+'</div>'
										+'</div>'
										+'<div class="modal-footer justify-content-between">'
											+'<button type="button" class="btn  btn-danger" data-dismiss="modal">Close</button>'
											+'<button type="button" class="btn btn-primary reject_comment_diamond">Yes</button>'
										+'</div>'
									+'</div>'
								+'</div>'
					);
					$('#header-modal').modal('show');

					var max_length = 100;
					$('.comment').keyup(function() {
						$('.com').html('');
						var textlen = $(this).val().length;
						if (textlen = 100) {
						var len = max_length - $(this).val().length;
						$('.GFG').text(len);
						}
					});
					$('#header-modal').delegate('.reject_comment_diamond', 'click', function() {
						$('.com').html('');
						var comment = $("#comment").val();
						if (comment == '') {
							var mssag = 'Please enter comment';
							$('.com').html(mssag);
						}else{
                            $('#header-modal').modal('hide');
                            blockUI.block();
							request_call("{{ url('admin-update-order-status')}}", "customer_id=" + customer_id + "&orders_id=" + id + "&order_status=" + order_status + "&certino=" + certino + "&comment=" + encodeURIComponent(comment));
							xhr.done(function(mydata) {
                                blockUI.release();
								Swal.fire({
									title: "Rejected",
									text: 'Rejected successfully...!!',
									type: "Warning",
								}).then((result) => {
									location.reload();
								});
							});
						}
					});
				} else if (order_status == "APPROVED") {

					Swal.fire({
						title: 'Are you sure you want to Approve Diamond?',
						text: "You won't be able to revert this!",
						icon: 'warning',
						showCancelButton: true,
						confirmButtonColor: '#3085d6',
						cancelButtonColor: '#d33',
						confirmButtonText: 'Yes, Approve it!',
					}).then((result) => {
						if (result.isConfirmed) {
                            blockUI.block();
							request_call("{{ url('admin-update-order-status')}}", "customer_id=" + customer_id + "&orders_id=" + id + "&order_status=" + order_status + "&certino=" + certino);
							xhr.done(function(mydata) {
                                blockUI.release();
								Swal.fire({
									title: "Approved",
									text: 'Approved successfully...!!',
									type: "success",
								}).then((result) => {
									location.reload();
								});
							});
						}
					});
				}
			});

			$('#kt_content_container').delegate('.supplier_confirm_popup', 'click', function() {
				var id = [];
				var certi_no = [];
				var customer_id = '';
				var checkpickups = 0;
				$(":checkbox:checked").each(function() {
					certi_no.push($(this).attr('data-certi_no'));
					id.push($(this).val());
					customer_id = $(this).attr('data-customer_id');
                    if($(this).data('pickups') == 1){
                        checkpickups += 1;
                    }
				});
				var checkpricesave = 0;
                $(".save_active").each(function() {
					checkpricesave += 1;
				});
				if (checkpickups != 0) {
					Swal.fire("Warning!", "QC Request Already Done From The Seleced Stone ..!!", "warning");
				}else if (checkpricesave != 0) {
					Swal.fire("Warning!", "save diamond price before pickup.", "warning");
				} else if (id == "" && certi_no == "") {
					Swal.fire("Warning!", "Please Select at least one record.", "warning");
				} else {
                    blockUI.block();
					request_call("{{ url('admin-confirm-to-supplier') }}", "certi_no=" + certi_no + "&orders_id=" + id + "&customer_id=" + customer_id);
					xhr.done(function(mydataorder) {
                        blockUI.release();
						if (mydataorder.error == false) {
							Swal.fire("Warning!", "diamond already Requested for QC.", "warning");
						} else {
							$("#header-modal").html("<div class='modal-dialog modal-dialog-centered modal-fullscreen' role='document'>"
								+ "<div class='modal-content'>"
									+ "<div class='modal-header'>"
										+ "<h4 class='modal-title'>Are you sure you want to send diamond to qc?</h4>"
										+ "<div class='card-toolbar'><a id='save_confirm_data' class='btn btn-sm btn-success me-2'>Confirm</a>"
										+ "<button class='btn btn-sm btn-danger' data-bs-dismiss='modal'>Cancel</button></div>"
										+ "<div class='btn btn-icon btn-sm btn-active-light-primary ms-2' data-bs-dismiss='modal' aria-label='Close'><i class='fa fa-times'></i></div>"
									+ "</div>" +
									"<div class='modal-body'>" +
										"<div class='row grid-block' style='margin:0px;'>" +
										"<div id='discont_message_popup'></div>" +
										"<table class='table center table-striped table-bordered bulk_action'>" +
										"<tr><td>Total Stone : <b>" + mydataorder.totalstone + "</b> | Total Carat : <b>" + mydataorder.TotalCarat + "</b> | Total A Per Carat : <b>" + mydataorder.TotalAPerCarat + "</b> | Total A Price : <b>" + mydataorder.TotalAPrice + "</b></td></tr>" +
										"</table>" +
										"" + mydataorder.render_msg + "" +
									"</div>" +
								"</div>" +
								"</div>"
							);
							$('#header-modal').modal('show');
							$('.date-picker').daterangepicker({
								singleDatePicker: true,
								parentEl: "#header-modal .modal-body",
								autoApply: true,
							});
						}
					});
				}
			});

			$('#header-modal').delegate('#save_confirm_data', 'click', function(event) {
				var flag = true;
				$(".city").removeClass("border-danger");
				$(".city").each(function() {
					if ($(this).val() == "") {
						$(this).addClass("border-danger");
						flag = false;
					}
				});
				if (flag == true) {
					var array_value = [];
					$('.pickup_row').each(function() {
                        twizzer_video = 0;
                        if($("#twizzer_video").is(':checked')){
                            twizzer_video = 1;
                        }
						array_value.push({
							dateval: $(this).find(".pickup_date").val(),
							id: $(this).find(".pickup_date").attr('id'),
							city: $(this).find(".city").val(),
                            twizzer_video : twizzer_video,
						});
					});
					var temp_data = JSON.stringify(array_value);
                    $('#header-modal').modal('hide');
                    blockUI.block();
					request_call("{{ url('admin-confirmToSupplier') }}", "data=" + temp_data);
					xhr.done(function(mydata) {
                        blockUI.release();
						if (mydata.success) {
							$('.check_box:checked').each(function() {
								$(this).parents("tr").addClass("text-success");
								this.checked = false;
							});
							selected_ids = "";
							total_selected = totalstone = 0;
							$('#total_pcs').text(0);
							$('#totalcarat').html(0);
							$('#totalrap').html(0);
							$('#totaldiscount').html(0);
							$('#totalpercarat').html(0);
							$('#totalamount').html(0);
							$('#totalApercarat').html(0);
							$('#totalAamount').html(0);

                            Swal.fire({
								title: "success",
								text: 'Qc Request sent successfully.',
								type: "success",
							}).then((result) => {
								location.reload();
							});
						}
						else
                        {
							Swal.fire("Warning!", "Fail to confirm to supplier.", "warning");
						}
					});
				}
			});

            $('.invoice_popup').click(function() {
				var id = [];
				var orders_id = [];
				var certi_no = [];
				var qc_review = [];
				var qc_small_status = [];
				var customer_id = $('#customer_id').val();

				$("#render_string :checkbox:checked").each(function() {
					orders_id.push($(this).attr('data-orders_id'));
					certi_no.push($(this).attr('data-certi_no'));
					qc_review = $(this).attr('data-qc_review');
					qc_small_status = $(this).attr('data-qc_small_status');
					id.push($(this).val());
					if((qc_review == 'QC REVIEW OUT' || qc_review == 'QC REVIEW IN') && (qc_small_status == 'N' || qc_small_status == '') ){
						qc_review_status_popup();
						return false;
					}
				});
				var checkpricesave = 0;
				$(".save_active").each(function() {
					checkpricesave += 1;
				});
				if((qc_review == 'QC REVIEW OUT' || qc_review == 'QC REVIEW IN') && (qc_small_status == 'N' || qc_small_status == '')){
					qc_review_status_popup();
				}else{
					if (checkpricesave != 0) {
						Swal.fire("Warning!", "Save diamond price before creating invoice", "warning");
					} else if (id == "" && orders_id == "" && certi_no == "") {
						Swal.fire("Warning!", "Please Select at least one record", "warning");
					} else {
                        blockUI.block();
						request_call("{{ url('admin-invoice-popup') }}", "orders_id=" + orders_id + "&certi_no=" + certi_no + "&customer_id=" + customer_id);
						xhr.done(function(mydataorder) {
                            blockUI.release();
							if (mydataorder.error == false) {
								Swal.fire("Warning!", "First confirm to supplier", "warning");
							} else {
                                var option = '';
                                var address = '';
                                $.each(mydataorder.associate, function(associates, item) {
                                    option += "<option value='"+ item.id +"'>"+ item.name +"</option>";
                                });
                                $.each(mydataorder.addresses, function(addresses, item) {
                                    var selec = '';
                                    if(item.by_default == 1){
                                        selec = 'selected';
                                    }
                                    address += "<option value='"+ item.add_id +"' "+ selec +">"+ item.state +"</option>";
                                });
								$("#header-modal").html("<div class='modal-dialog modal-xl modal-dialog-centered modal-fullscreen' style='min-width:65%;'>" +
									"<div class='modal-content'>" +
									"<div class='modal-header'>" +
										"<h4 class='modal-title'><strong>Create Invoice</strong></h4>" +
										"<div><label class='text-muted fs-7 form-label'>Default input</label><select id='associate' class='form-select mw-150px me-2'>"+ option +"</select></div>"+
                                        "<div><label class='text-muted fs-7 form-label'>Local</label><br/><input type='checkbox' id='local' value='1'></div>"+
                                        "<div><label class='text-muted fs-7 form-label'>address</label><select id='address_id' class='form-select mw-150px me-2'><option value=''>SELECT AN ADDRESS</option>"+ address +"</select></div>"+
                                        "<div><label class='text-muted fs-7 form-label'>Shipping</label><select id='shipping_val' class='form-select mw-150px me-2'><option value='FEDEX'>FEDEX</option><option value='UPS'>UPS</option><option value='MA-Express'>MA-Express</option><option value='JK-MALCA AMIT'>JK-MALCA AMIT</option><option value='B.V.C'>BVC</option><option value='BVC'>BVC FOB</option><option value='Other'>Other</option></select></div>"+
                                        "<div><label class='text-muted fs-7 form-label'>shipping charge</label><input class='form-control mw-90px' id='shipping_charge' type='number' value='0'></div>"+
                                        "<div><label class='text-muted fs-7 form-label'>Extra Discount $</label><input class='form-control mw-90px' id='discount_extra_order' type='number' value='0'></div>"+
                                        "<div><label class='text-muted fs-7 form-label'>Consignee</label><br/><input type='checkbox' id='consignee' value='1'></div>"+
                                        "<div><label class='text-muted fs-7 form-label'>consignee no</label><input class='form-control mw-90px' id='consignee_no' type='text' value='' placeholder='consignee no'></div>"+
										"<button id='create_invoice' class='btn btn-success me-2'>Invoice</button>" +
										"<div class='btn btn-icon btn-sm btn-active-light-primary ms-2' data-bs-dismiss='modal' aria-label='Close'><i class='fa fa-times'></i></div>" +
									"</div>" +
									"<div class='modal-body'>" +
										"<div class='row grid-block'>" +
                                        "<table class='table center table-striped table-bordered bulk_action'>" +
                                            "<tr>" +
                                                "<td colspan='5'>Diamonds : <b>" + totalstone + "</b> | Carats : <b>" + TotalCarat + "</b> | Sale Per Carat : <b>" + TotalPerCarat + "</b> | Sale Price : <b>" + TotalPrice + "</b></td>"+
                                                "<input class='form-control mw-150px' id='extra_save' type='hidden' value='" + mydataorder.discountamount + "'></td>"+
                                            "</tr>" +
                                        "</table>" +
										"" + mydataorder.render_msg + "" +
										"</div>" +
									"</div>" +
									"</div>" +
									"</div>"
								);
								$('#header-modal').modal('show');
							}
						});
					}

				}
			});

            $('#header-modal').delegate('#create_invoice', 'click', function(event) {
				var id = [];
				var orders_id = [];
				var certi_no = [];
				var discount = [];
				var net = [];
				var sumrap = 0;
				var netsum = 0;
				var customer_id = $('#customer_id').val();
				var discount_extra_order = $('#discount_extra_order').val();
				var extra_save = $('#extra_save').val();
				if (!extra_save) {
					extra_save = 0;
				}
				var shipping = $('#shipping_val').val();
                var associate = $('#associate').val();
                var shipping_charge = $('#shipping_charge').val();
                let consignee_no = $('#consignee_no').val();
                let address_id = $('#address_id').val();
                let consignee = 0;
                let local = 0;
                if ($("#consignee").is(':checked')) {
                    consignee = 1;
                }
                if ($("#local").is(':checked')) {
                    local = 1;
                }

				$("#render_string :checkbox:checked").each(function() {
					net.push($(this).attr('data-price'));
					orders_id.push($(this).attr('data-orders_id'));
					certi_no.push($(this).attr('data-certi_no'));
					discount.push($(this).attr('data-discount'));
					id.push($(this).val());
					sumrap = sumrap + parseInt($(this).attr('data-onerap'));
					netsum = netsum + parseFloat($(this).attr('data-price'));
				});
				var avg_discount = (netsum / sumrap * 100 - 100).toFixed(2);
				if (id == "" && orders_id == "" && certi_no == "") {
					Checked_Stone();
				} else {
                    $('#header-modal').modal('hide');
                    blockUI.block();
					request_call("{{ url('admin-create-invoice') }}", "orders_id=" + orders_id + "&certi_no=" + certi_no + "&customer_id=" + customer_id + "&discount_extra_order=" + discount_extra_order + "&extra_save=" + extra_save + "&shipping=" + shipping + "&discount=" + avg_discount + "&amt=" + netsum + "&associate="+ associate + "&shipping_charge=" + shipping_charge + "&consignee=" + consignee + "&consignee_no=" + consignee_no + "&address_id=" + address_id + "&local=" + local);
					xhr.done(function(mydataorder) {
                        blockUI.release();
						if ($.trim(mydataorder.success) != "") {
							$(":checkbox:checked").each(function() {
								$(this).closest('tr').html('');
							});
							Swal.fire({
								title: "success",
								text: 'Invoice is ready',
								type: "success",
							}).then((result) => {
								location.reload();
							});
						}
					});
				}
			});

            $('.perfoma_invoice_popup').click(function() {
				var id = [];
				var orders_id = [];
				var certi_no = [];
				var qc_review = [];
				var qc_small_status = [];
				var customer_id = $('#customer_id').val();

				$("#render_string :checkbox:checked").each(function() {
					orders_id.push($(this).attr('data-orders_id'));
					certi_no.push($(this).attr('data-certi_no'));
					qc_review = $(this).attr('data-qc_review');
					qc_small_status = $(this).attr('data-qc_small_status');
					id.push($(this).val());
					if((qc_review == 'QC REVIEW OUT' || qc_review == 'QC REVIEW IN') && (qc_small_status == 'N' || qc_small_status == '') ){
						qc_review_status_popup();
						return false;
					}
				});
				var checkpricesave = 0;
				$(".save_active").each(function() {
					checkpricesave += 1;
				});
				if((qc_review == 'QC REVIEW OUT' || qc_review == 'QC REVIEW IN') && (qc_small_status == 'N' || qc_small_status == '')){
					qc_review_status_popup();
				}else{
					if (checkpricesave != 0) {
						Swal.fire("Warning!", "Save diamond price before creating invoice", "warning");
					} else if (id == "" && orders_id == "" && certi_no == "") {
						Swal.fire("Warning!", "Please Select at least one record", "warning");
					} else {
                        blockUI.block();
						request_call("{{ url('admin-perfoma-popup') }}", "orders_id=" + orders_id + "&certi_no=" + certi_no + "&customer_id=" + customer_id);
						xhr.done(function(mydataorder) {
                            blockUI.release();
							if (mydataorder.error == false) {
								Swal.fire("Warning!", "First confirm to supplier", "warning");
							} else {
                                var option = '';
                                var address = '';
                                $.each(mydataorder.associate, function(associates, item) {
                                    option += "<option value='"+ item.id +"'>"+ item.name +"</option>";
                                });
                                $.each(mydataorder.addresses, function(addresses, item) {
                                    var selec = '';
                                    if(item.by_default == 1){
                                        selec = 'selected';
                                    }
                                    address += "<option value='"+ item.add_id +"' "+ selec +">"+ item.state +"</option>";
                                });

								$("#header-modal").html("<div class='modal-dialog modal-xl modal-fullscreen'>" +
									"<div class='modal-content'>" +
									"<div class='modal-header'>" +
										"<h4 class='modal-title'><strong>Create Performa Invoice</strong></h4>" +
										"<div><label class='text-muted fs-7 form-label'>Default input</label><select id='associate' class='form-select mw-150px me-2'>"+ option +"</select></div>"+
                                        "<div><label class='text-muted fs-7 form-label'>address</label><select id='address_id' class='form-select mw-150px me-2'><option value=''>SELECT AN ADDRESS</option>"+ address +"</select></div>"+
                                        "<div><label class='text-muted fs-7 form-label'>Shipping</label><select id='shipping_val' class='form-select mw-150px me-2'><option value='FEDEX'>FEDEX</option><option value='UPS'>UPS</option><option value='MA-Express'>MA-Express</option><option value='JK-MALCA AMIT'>JK-MALCA AMIT</option><option value='B.V.C'>BVC</option><option value='BVC'>BVC FOB</option><option value='Other'>Other</option></select></div>"+
                                        "<div><label class='text-muted fs-7 form-label'>shipping charge</label><input class='form-control mw-90px' id='shipping_charge' type='number' value='0'></div>"+
                                        "<div><label class='text-muted fs-7 form-label'>Extra Discount $</label><input class='form-control mw-90px' id='discount_extra_order' type='number' value='0'></div>"+
                                        "<div><label class='text-muted fs-7 form-label'>Consignee</label><br/><input type='checkbox' id='consignee' value='1'></div>"+
                                        "<div><label class='text-muted fs-7 form-label'>consignee no</label><input class='form-control mw-90px' id='consignee_no' type='text' value='' placeholder='consignee no'></div>"+
										"<button id='create_perfoma' class='btn btn-success me-2'>Perfoma</button>" +
										"<div class='btn btn-icon btn-sm btn-active-light-primary ms-2' data-bs-dismiss='modal' aria-label='Close'><i class='fa fa-times'></i></div>" +
									"</div>" +
									"<div class='modal-body'>" +
										"<div class='row grid-block'>" +
                                        "<table class='table center table-striped table-bordered bulk_action'>" +
                                            "<tr>" +
                                                "<td colspan='5'>Diamonds : <b>" + totalstone + "</b> | Carats : <b>" + TotalCarat + "</b> | Sale Per Carat : <b>" + TotalPerCarat + "</b> | Sale Price : <b>" + TotalPrice + "</b></td>"+
                                                "<input class='form-control mw-150px' id='extra_save' type='hidden' value='" + mydataorder.discountamount + "'></td>"+
                                            "</tr>" +
                                        "</table>" +
										"" + mydataorder.render_msg + "" +
										"</div>" +
									"</div>" +
									"</div>" +
									"</div>"
								);
								$('#header-modal').modal('show');
							}
						});
					}

				}
			});

            $('#header-modal').delegate('#create_perfoma', 'click', function(event) {
				var id = [];
				var orders_id = [];
				var certi_no = [];
				var discount = [];
				var net = [];
				var sumrap = 0;
				var netsum = 0;
				var customer_id = $('#customer_id').val();
				var discount_extra_order = $('#discount_extra_order').val();
				var extra_save = $('#extra_save').val();
				if (!extra_save) {
					extra_save = 0;
				}
				var shipping = $('#shipping_val').val();
                var associate = $('#associate').val();
                var shipping_charge = $('#shipping_charge').val();
                let consignee_no = $('#consignee_no').val();
                let address_id = $('#address_id').val();
                let consignee = 0;
                if ($("#consignee").is(':checked')) {
                    consignee = 1;
                }

				$("#render_string :checkbox:checked").each(function() {
					net.push($(this).attr('data-price'));
					orders_id.push($(this).attr('data-orders_id'));
					certi_no.push($(this).attr('data-certi_no'));
					discount.push($(this).attr('data-discount'));
					id.push($(this).val());
					sumrap = sumrap + parseInt($(this).attr('data-onerap'));
					netsum = netsum + parseFloat($(this).attr('data-price'));
				});
				var avg_discount = (netsum / sumrap * 100 - 100).toFixed(2);
				if (id == "" && orders_id == "" && certi_no == "") {
					Checked_Stone();
				} else {
                    $('#header-modal').modal('hide');
                    blockUI.block();
					request_call("{{ url('admin-perfoma-invoice') }}", "orders_id=" + orders_id + "&certi_no=" + certi_no + "&customer_id=" + customer_id + "&discount_extra_order=" + discount_extra_order + "&extra_save=" + extra_save + "&shipping=" + shipping + "&discount=" + avg_discount + "&amt=" + netsum + "&associate="+ associate + "&shipping_charge=" + shipping_charge + "&consignee=" + consignee + "&consignee_no=" + consignee_no + "&address_id=" + address_id );
					xhr.done(function(mydataorder) {
                        blockUI.release();
						if ($.trim(mydataorder.success) != "") {
							$(":checkbox:checked").each(function() {
								$(this).closest('tr').html('');
							});
							Swal.fire({
								title: "success",
								text: 'Perfoma is ready',
								type: "success",
							}).then((result) => {
								location.reload();
							});
						}
					});
				}
			});

            $('#render_string').delegate('.fa-plus', 'click', function() {
                $(".detail_view").each(function(e) {
                    $(this).remove();
                });

                $(".fa-minus").each(function(e) {
                    $(this).removeClass("fa-minus").addClass("fa-plus");
                });

                $(this).removeClass("fa-plus").addClass("fa-minus");

                var parent_tr = $(this).parents('tr');
                var id = $(this).data('id');

                blockUI.block();
                request_call("{{ url('admin-view-order-detail')}}", "id="+id);
                xhr.done(function(mydata) {
                    if ($.trim(mydata.detail) != "") {
                        blockUI.release();
                        parent_tr.after("<tr class='detail_view'><td colspan='100%'> " + $.trim(mydata.detail) + " </td></tr>");
                    }
                });
            });

            $('#render_string').delegate('.fa-minus', 'click', function() {
                blockUI.block();
                $(this).removeClass("fa-minus").addClass("fa-plus");
                var parent_tr = $(this).parents('tr');
                parent_tr.next("tr.detail_view").remove();
                blockUI.release();
            });

            $("#render_string").delegate(".edit_price", "click", function () {
				var ids = $(this).attr('data-id');
				var certino = $(this).attr('data-certino');

                var sale_price = $(this).attr('data-sale_price');
                var buy_price = $(this).attr('data-buy_price');
                var carat = $(this).attr('data-carat');
                $("#header-modal").html('<div class="modal-dialog modal-md">'
                            +'<div class="modal-content">'
                                +'<div class="modal-header">'
                                    +'<h4 class="modal-title">Update Price Certi # : '+certino+'</h4>'
                                    +'<div class="btn btn-icon btn-sm btn-active-light-primary ms-2" data-bs-dismiss="modal" aria-label="Close"><i class="fa fa-times"></i></div>'
                                +'</div>'
                                +'<div class="modal-body">'
                                    +'<div class="row">'
                                        +'<div class="col-md-6 col-sm-3 col-xs-12">'
                                            +'<input type="hidden" class="form-control" name="order_id" id="order_id_popup" value="'+ids+'" />'
                                            +'<input type="hidden" class="form-control" name="carat" id="order_carat_popup" value="'+carat+'" />'
                                            +'<label for="exampleFormControlInput1" class="required form-label">Sale Price</label>'
                                            +'<input type="text" class="form-control" name="sale_price" id="sale_price" value="'+sale_price+'" required />'
                                        +'</div>'
                                        +'<div class="col-md-6 col-sm-3 col-xs-12">'
                                            +'<label for="exampleFormControlInput1" class="required form-label">Buy Price</label>'
                                            +'<input type="text" class="form-control" name="buy_price" id="buy_price" value="'+buy_price+'" required />'
                                        +'</div>'
                                    +'</div>'
                                +'</div>'
                                +'<div class="modal-footer justify-content-between">'
                                    +'<button type="button" class="btn  btn-danger" data-bs-dismiss="modal">Close</button>'
                                    +'<button type="button" class="btn btn-primary save_price">Save</button>'
                                +'</div>'
                            +'</div>'
                        +'</div>'
                );
                $('#header-modal').modal('show');
				// KTApp.blockPage({
				// 	overlayColor: '#000000',
				// 	state: 'primary',
				// 	message: 'Processing...'
				// });
				// request_call("{{ url('admin-check-pickup') }}", "ids=" + ids + "&certino=" + certino);
				// xhr.done(function (mydataorder) {
				// 	// KTApp.unblockPage();
				// 	if (mydataorder != "0")
				// 	{
				// 		$('#hide_edit_' + ids).hide();
				// 		$('#price_hidden_' + ids).hide();
				// 		$('#a_price_hidden_' + ids).hide();
				// 		$('#price_change_' + ids).show();
				// 		$('#a_price_change_' + ids).show();
				// 		$('#hide_save_' + ids).show();
				// 		$('#hide_save_' + ids).addClass("save_active");

				// 	} else
				// 	{
				// 		$('#hide_edit_' + ids).hide();
				// 		$('#price_hidden_' + ids).hide();
				// 		// $('#a_price_hidden_'+ids).hide();
				// 		$('#price_change_' + ids).show();
				// 		// $('#a_price_change_'+ids).show();
				// 		$('#hide_save_' + ids).show();
				// 		$('#hide_save_' + ids).addClass("save_active");
				// 		// alreadypickup();
				// 	}
				// });
			});

			$("#header-modal").delegate(".save_price", "click", function () {
				var orders_id = $('#order_id_popup').val();
                var sale_price = $('#sale_price').val();
                var buy_price = $('#buy_price').val();
                var carat = $('#order_carat_popup').val();

				if (sale_price != "" && buy_price != "")
				{
                    $('#header-modal').modal('hide');
                    blockUI.block();
					request_call("{{ url('admin-update-order-price') }}", "orders_id=" + $.trim(orders_id) + "&sale_price=" + sale_price + "&buy_price=" + buy_price+ "&carat=" + carat);
					xhr.done(function (mydata) {
                        blockUI.release();
                        if(mydata.success == true)
                        {
                            Swal.fire({
                                title: "Success",
                                text: mydata.message,
                                type: "success",
                            }).then((result) => {
                                location.reload();
                            });
                        }
                        else if(mydata.success == false)
                        {
                            Swal.fire({
                                title: "Warning",
                                text: mydata.message,
                                type: "warning",
                            }).then((result) => {
                                location.reload();
                            });
                        }
					});
				}
				else
				{
					Swal.fire({title: "Rejected", text: 'Price Empty...!!', type: "Warning"});
				}
			});

            $('.reverse_diamond').click(function() {
                var orders_id = [];
                $("#render_string :checkbox:checked").each(function() {
					orders_id.push($(this).attr('data-orders_id'));
				});

                Swal.fire({
                    title: 'Are you sure you want to reverse Diamond?',
                    text: "You won't be able to revert this!",
                    icon: 'warning',
                    showCancelButton: true,
                    confirmButtonColor: '#3085d6',
                    cancelButtonColor: '#d33',
                    confirmButtonText: 'Yes, reverse it!',
                }).then((result) => {
                    if (result.isConfirmed) {
                        blockUI.block();
                        request_call("{{ url('admin-order-reverse')}}", "customer_id=" + customer_id + "&orders_id=" + orders_id);
                        xhr.done(function(mydata) {
                            blockUI.release();
                            Swal.fire({
                                title: "Approved",
                                text: 'reverse successfully...!!',
                                type: "success",
                            }).then((result) => {
                                location.reload();
                            });
                        });
                    }
                });
            });

            $('.release_diamond').click(function() {
                var orders_id = [];
                let customer_id = '';
                $("#render_string :checkbox:checked").each(function() {
					orders_id.push($(this).attr('data-orders_id'));
                    customer_id = $(this).attr('data-customer_id')
				});

                Swal.fire({
                    title: 'Are you sure you want to release Diamond?',
                    text: "You won't be able to revert this!",
                    icon: 'warning',
                    showCancelButton: true,
                    confirmButtonColor: '#3085d6',
                    cancelButtonColor: '#d33',
                    confirmButtonText: 'Yes, release it!',
                }).then((result) => {
                    if (result.isConfirmed) {
                        blockUI.block();
                        request_call("{{ url('admin-order-release')}}", "customer_id=" + customer_id + "&orders_id=" + orders_id);
                        xhr.done(function(mydata) {
                            blockUI.release();
                            Swal.fire({
                                title: "Approved",
                                text: 'release successfully...!!',
                                type: "success",
                            }).then((result) => {
                                location.reload();
                            });
                        });
                    }
                });
            });
		});
	</script>